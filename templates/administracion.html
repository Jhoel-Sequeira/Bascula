{% extends "layout.html" %}
{% block title %}
Historial
{% endblock %}
{%block head%}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


<link rel="stylesheet" href="../static/css/filter_multi_select.css" />
<script src="../static/js/filter-multi-select-bundle.min.js"></script>

<link rel="stylesheet" href="/path/to/cdn/bootstrap.min.css" />
<script src="/path/to/cdn/jquery.slim.min.js"></script>

<script
    src="https://raw.githubusercontent.com/dallaslu/bootstrap-5-multi-level-dropdown/master/bootstrap5-dropdown-ml-hack.js"></script>

{%endblock%}
{% block
encabezado %}
<div class="row">
    <div class="col">
        <h1><a href="/ajustes" style="text-decoration: none; color: black;">Historial</a></h1>
    </div>
</div>
{% endblock %}
{% block content %}
<div class="">
    <div class="d-flex flex-wrap mt-2">

        <div class="col-10 mb-3 mb-lg-0" id="filtros" role="search">
            <input type="text" id="buscarAdmin" name="buscarAdmin" onkeyup="this.value=this.value.toUpperCase()"
                style="text-transform:uppercase;" placeholder="Ingrese la PO" required="required"
                class="form-control" />

        </div>
        <div class="col " style="color:rgb(121, 121, 121); font-size: 20px; margin-left: 30px; ">


            <button class="btn btn-secondary" onclick="verFiltros()" type="button" id="dropdownMenuButton1"
                data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa-solid fa-filter"></i>
            </button>

        </div>
    </div>


</div>
<script>
    function verFiltros() {
        if ($('#filtro').is(':visible')) {
            $('#filtro').hide();
        } else {
            $('#filtro').show();
        }
    }
</script>

<div class="container mt-3" id="filtro" style="display: none;">
    <div class="row">
        <div class="col-8">
            <select multiple name="filtro" id="filtroOpc" class="filter-multi-select">

                <option value="1">Proveedor</option>
                <option value="2">Fecha</option>
                <option value="3">Estado</option>
                <option value="4">Digitador</option>
                <option value="5">Verificador</option>
            </select>

        </div>
    </div>
</div>



<div class="row justify-content-md-center">
    <div class="col mt-3 overflow-auto rounded bg-light" id="tabla-adm" style="height: 87vh;"></div>
</div>
<div class="row">
    Deslice hacia la derecha para ver mas información
</div>
<script>
    $(document).on("change", "#filtroOpc", function (event) {
        var selected = $('#filtroOpc').val();
        $.ajax({
            url: "/valorTablaAdmin",
            type: "POST",
            data: {
                valor: selected,
                po: $('#buscarAdmin').val()

            },
            success: function (response) {
                $('#tabla-adm').html(response);
                $('#tabla-adm').append(response.htmlresponse);
            },
            error: function (error) { // console.log(error);
            }
        });

    });
    function vacioVer() {
        opc = "po"
        $.ajax({
            url: "/valorTablaAdmin",
            type: "POST",
            data: {
                valor: opc,
                po: ""

            },
            success: function (response) {
                $('#tabla-adm').html(response);
                $('#tabla-adm').append(response.htmlresponse);
            },
            error: function (error) { // console.log(error);
            }
        });
    }
    $(document).ready(function () {
        $("#buscador").hide();
        $('#listaProv').hide();

        vacioVer()

    });
    var opc = "po";
    var buscar = function () {
        var proveedor = $('#buscarAdmin').val();
        if (proveedor != "") {
            $.ajax({
                url: "/valorTablaAdmin",
                type: "POST",
                data: {
                    valor: opc,
                    po: $('#buscarAdmin').val()

                },
                success: function (response) {
                    $('#tabla-adm').html(response);
                    $('#tabla-adm').append(response.htmlresponse);
                },
                error: function (error) { // console.log(error);
                }
            });
        } else {
            vacioVer();

            $('#contenerLista').hide();
        }


    }
    $("#buscarAdmin").on('keyup', buscar);

</script>
<script>



    $('#filtroOpc').filterMultiSelect({
        selectAllText: 'Todo',
        placeholderText: 'filtrar por..',
        filterText: 'buscar',
        caseSensitive: true,
    });
    $('#filtroOpc').on("optionselected", function (e) {

        filtro = e.detail.label
        //    MANDAMOS A ESCRIBIR LOS FILTROS QUE HA SELECCIONADO EL USUARIO
        $.ajax({
            url: "/AñadirFiltro",
            type: "POST",
            data: {
                filtro: filtro

            },
            success: function (response) {
                $('#tabla-adm').html(response);
                $('#tabla-adm').append(response.htmlresponse);
            },
            error: function (error) { // console.log(error);
            }
        });


        var b = true;
        var filtroJson = JSON.stringify(getJson(b), null, "  ");
        $('#filtrosInput').text(filtroJson);
    });
    $('#filtroOpc').on("optiondeselected", function (e) {

        var b = true;
        var filtroJson = JSON.stringify(getJson(b), null, "  ");
        $('#jsonresult1').text();
    });

    var getJson = function (b) {
        var result = $.fn.filterMultiSelect.applied
            .map((e) => JSON.parse(e.getSelectedOptionsAsJson(b)))
            .reduce((prev, curr) => {
                prev = {
                    ...prev,
                    ...curr,
                };
                return prev;
            });
        return result;
    }
   // new MultiSelectTag('filtroOpc')  // id
</script>
</div>
{% endblock %}